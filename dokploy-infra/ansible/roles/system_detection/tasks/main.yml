---
- name: Detect if running on WSL
  shell: "grep -qi microsoft /proc/version"
  register: wsl_check
  failed_when: false
  changed_when: false

- name: Set WSL fact
  set_fact:
    is_wsl: "{{ wsl_check.rc == 0 }}"

- name: Display WSL detection result
  debug:
    msg: "Running on WSL: {{ is_wsl }}"

- name: Check systemd availability
  shell: "ps --no-headers -o comm 1"
  register: init_system
  changed_when: false
  failed_when: false

- name: Set systemd fact
  set_fact:
    has_systemd: "{{ init_system.stdout == 'systemd' }}"

- name: Display systemd status
  debug:
    msg: "Systemd available: {{ has_systemd }}"

- name: Get distribution information
  set_fact:
    distro_id: "{{ ansible_distribution | lower }}"
    distro_version: "{{ ansible_distribution_version }}"
    distro_release: "{{ ansible_distribution_release }}"

- name: Detect architecture
  set_fact:
    system_arch: "{{ ansible_architecture }}"

- name: Display system information
  debug:
    msg: 
      - "Distribution: {{ distro_id }}"
      - "Version: {{ distro_version }}"
      - "Release: {{ distro_release }}"
      - "Architecture: {{ system_arch }}"

- name: Check memory
  set_fact:
    total_memory_mb: "{{ ansible_memtotal_mb }}"

- name: Warn if memory is low
  debug:
    msg: "⚠️  WARNING: System has {{ total_memory_mb }}MB RAM. Recommended minimum is {{ min_memory_mb }}MB"
  when: total_memory_mb | int < min_memory_mb | int

- name: Check disk space
  shell: "df -BG / | tail -1 | awk '{print $4}' | sed 's/G//'"
  register: disk_space
  changed_when: false

- name: Warn if disk space is low
  debug:
    msg: "⚠️  WARNING: Available disk space is {{ disk_space.stdout }}GB. Recommended minimum is {{ min_disk_gb }}GB"
  when: disk_space.stdout | int < min_disk_gb | int
